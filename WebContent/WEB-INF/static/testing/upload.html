<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <title>上传文件</title>
    <link rel="stylesheet" href="base.css" />
    <script src="http://www.jq22.com/jquery/1.11.1/jquery.min.js"></script>

    <style>

        body{
            background-color: #F7F9F7;
            margin: 0;
        }

        .title {
            width: 100%;
            height: 150px;
            color: white;
            font-size: 36px;
            line-height: 150px;
            text-align: center;
            background-color: #3a445fab;
        }


        .content {
            width: 500px;
            margin: 0 auto;
            display: flex;
            padding-top: 50px;
        }

        .content_l {
            width: 60%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .fileBox {
            width: 100%;
        }

        .fileDragArea {
            width: 100%;
            height: 50px;
            box-sizing: border-box;
            border: 2px dashed #ccc;
            text-align: center;
            line-height: 50px;
            position: relative;
        }

        .fileInput {
            width: 100%;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            opacity: 0;

        }

        .progressView {
            width: 0%;
            height: 100%;
            background-color: #EAA625;
            position: absolute;
            left: 0;
            top: 0;

        }

        .progressTextView {
            width: 100%;
            height: 100%;
            font-size: 12px;
            position: absolute;
            color: #444;
            left: 0;
            top: 0;
        }

        .comment {
            width: 100%;
            height: 150px;
            margin-top: 20px;
            display: block;
            box-sizing: border-box;
            resize: none;
        }

        .radio_c {
            display: flex;
            flex-direction: row;
            justify-content: center;
            margin: 30px 0;
        }

        .radio_android_c {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .radio_ios_c {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: 50px;
        }

        .androidImg {
            width: 30px;
            height: 30px;
            margin-bottom: 10px;
        }

        .iosImg {
            width: 30px;
            height: 30px;
            margin-bottom: 10px;
        }

        .uploadBtn {
            width: 100%;
            height: 50px;

            background-color: #708090;
            position: relative;
            font-size: 12px;
            color: #fff;
            border-radius: 5px;
        }




        .content_r {
            width: 220px;
            margin-left: 10px;
            display: flex;
            flex-direction: column;
            
        }

        .qrcode {
            width: 220px;
            height: 220px;
            background-color: white;
            border-radius:5px;
            
            
        }

        input {
            margin: 0;
        }
    </style>

</head>


<body>

    <div class="root">
        <div class="title">
            爱唱-内测包发布平台
        </div>


        <div class="content">

            <div class="content_l">

                <div class="fileBox">
                    <div class="fileDragArea">

                        <span class="progressView"></span>

                        <span class="progressTextView">点击选取文件或者将文件拖到此处</span>

                        <input type="file" multiple class="fileInput" />


                    </div>
                </div>

                <textarea placeholder="请输入更新内容" class="comment"></textarea>

                <div id="radio" class="radio_c">
                    <div class="radio_android_c">
                        <img class="androidImg">

                        <input type="radio" class="radio_android" name="divice" value="android" checked="true" />

                    </div>

                    <div class="radio_ios_c">
                        <img class="iosImg">
                        <input type="radio" class="radio_ios" name="divice" value="ios" />

                    </div>

                </div>

                <input type="button" value="上传" class="uploadBtn" />




            </div>

            <div class="content_r">


                <img class="qrcode"></img>


            </div>



        </div>

    </div>


</body>



<script>

    var androidIcon = "data:image/png;base64,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"
    var iosIcon = "data:image/png;base64,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"
    var transparentImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAP0lEQVR42mL8//8/AzEAIICYGIgEAAFEtEKAACJaIUAAEa0QIICIVggQQEQrBAggohUCBBDRCgECiGiFAAEGANUSAxEZNm5vAAAAAElFTkSuQmCC"

    var uploadBtnNormalColor = "#708090"
    var uploadBtnSuccessColor = "#3CB371"
    var uploadBtnFaildColor = "#FF6A6A"
</script>

<script>

    $(function () {


        //元素
        var oFileBox = $(".fileBox");					//选择文件父级盒子
        var fileInput = $(".fileInput");				//选择文件按钮

        var uploadBtn = $(".uploadBtn");					//上传按钮

        var progressView = $(".progressView");					//进度
        var progressTextView = $(".progressTextView");					//进度文本

        var androidImg = $(".androidImg")[0];
        var iosImg = $(".iosImg")[0];


        var radioAndroidC = $(".radio_android_c");
        var radioIosC = $(".radio_ios_c");


        var radioAndroid = $(".radio_android")[0];
        var radioIos = $(".radio_ios")[0];

        var qrCode=$(".qrcode")[0];

        var selectFile;

        androidImg.src = androidIcon
        iosImg.src = iosIcon


        radioAndroidC.click(function () {
            radioAndroid.checked = true;
            radioIos.checked = false;
        })

        radioIosC.click(function () {
            radioAndroid.checked = false;
            radioIos.checked = true;
        })
        qrCode.src = transparentImage



        //拖拽外部文件，进入目标元素触发
        fileInput.on("dragenter", function () {
            $(this).text("可以释放鼠标了！");
        });

        //拖拽外部文件，进入目标、离开目标之间，连续触发
        fileInput.on("dragover", function () {
            return false;
        });

        //拖拽外部文件，离开目标元素触发
        fileInput.on("dragleave", function () {
            $(this).text("或者将文件拖到此处");
        });

        //拖拽外部文件，在目标元素上释放鼠标触发
        fileInput.on("drop", function (ev) {
            var fs = ev.originalEvent.dataTransfer.files;
            analysis(fs);		//解析列表函数
            $(this).text("或者将文件拖到此处");
            return false;
        });

        //点击选择文件按钮选文件
        fileInput.on("change", function () {
            analysis(this.files);
        })

        //解析列表函数
        function analysis(obj) {
            //如果没有文件
            if (obj.length != 1) {
                alert("只允许一次上传一个文件")
                return;
            }



            var fileObj = obj[0];		//单个文件
            var name = fileObj.name;	//文件名
            var size = fileObj.size;	//文件大小
            var type = fileType(name);	//文件类型，获取的是文件的后缀



            //文件类型不为这三种，就不上传
            if (("apk/txt").indexOf(type) == -1) {
                alert('“' + name + '”文件类型不对，不能上传');
                return;
            }


            progressTextView.text(name)
            uploadBtn.css("background-color", uploadBtnNormalColor);
            uploadBtn.val("上传测试包")
            uploadBtn.on("click", function () { upload() });
            progressView.css("width", "0%");
            qrCode.src = transparentImage

            //给json对象添加内容，得到选择的文件的数据
            var itemArr = [fileObj, name, size, type];	//文件，文件名，文件大小，文件类型
            selectFile = itemArr

        };


        function upload() {
            uploadBtn.val("上传中")
            uploadBtn.off();

            var formData = new FormData();

            // 从当前项中获取上传文件，放到 formData对象里面，formData参数以key name的方式
            var result = selectFile[0];							//数据
            formData.append("file", result);

            // var name = selectFile[1];							//文件名
            // formData.append("email", name);

            var request = $.ajax({
                type: "POST",
                // url: "http://localhost:8080/AccountBook/testing/upload",
                url:"https://www.5aichang.cn/ac_android_test/checkup.php",
                data: formData,			//这里上传的数据使用了formData 对象
                processData: false, 	//必须false才会自动加上正确的Content-Type
                contentType: false,

                //这里我们先拿到jQuery产生的XMLHttpRequest对象，为其增加 progress 事件绑定，然后再返回交给ajax使用
                xhr: function () {
                    var xhr = $.ajaxSettings.xhr();
                    if (onprogress && xhr.upload) {
                        xhr.upload.addEventListener("progress", onprogress, false);
                        return xhr;
                    }
                },

                //上传成功后回调
                success: function (data) {
                    console.log("upload success,return data="+data)
                    uploadBtn.val("生成二维码中...")
                    getQrImage(data)
                },

                //上传失败后回调
                error: function () {
                    progressView.css("width", "0%");
                    progressTextView.html("上传失败");
                    uploadBtn.css("background-color", uploadBtnFaildColor);
                    uploadBtn.on();
                    uploadBtn.val("重新上传");
                }

            });


            //侦查附件上传情况 ,这个方法大概0.05-0.1秒执行一次
            function onprogress(evt) {
                var loaded = evt.loaded;	//已经上传大小情况  
                var tot = evt.total;		//附件总大小  
                var per = Math.floor(100 * loaded / tot);  //已经上传的百分比
                progressView.css("width", per + "%");
                progressTextView.html(per + "%");
            }




        }



    })




    function getQrImage(fileUrl) {


        var param = {};

        param.fileurl = fileUrl
        param.comment = $('#textarea').val()
        param.device = $('input:radio:checked').val()

        $.ajax({
            type: "POST",
            url: "http://localhost:8080/AccountBook/testing/qrcode_b64",
            data: param,			//这里上传的数据使用了formData 对象
            contentType: "application/x-www-form-urlencoded",
            dataType: "json",
            success: function (data) {
                $(".qrcode")[0].src = "data:image/png;base64," + data.data
                $(".uploadBtn").css("background-color", uploadBtnSuccessColor);
                $(".uploadBtn").val("生成二维码成功")
            },
            error: function (err) {
                $(".uploadBtn").css("background-color", uploadBtnFaildColor);
                $(".uploadBtn").val("生成二维码失败")
            }
        })

    }



    function getQrImageStream(fileUrl) {

        var param = {};

        param.fileurl = fileUrl
        param.comment = $('#textarea').val()
        param.device = $('input:radio:checked').val()

        var oReq = new XMLHttpRequest();

        oReq.open("POST", "http://localhost:8080/AccountBook/testing/qrcode", true);
        //设置请求头
        oReq.setRequestHeader("content-type", "application/x-www-form-urlencoded")

        oReq.responseType = "arraybuffer";

        oReq.onload = function (oEvent) {

            var arrayBuffer = oReq.response; // Note: not oReq.responseText
            var b64 = transformArrayBufferToBase64(arrayBuffer)

            $(".qrcode")[0].src = b64
            $(".uploadBtn").css("background-color", uploadBtnSuccessColor);
            $(".uploadBtn").val("生成二维码成功")

        };

        oReq.onerror = function (err) {
            $(".uploadBtn").css("background-color", uploadBtnFaildColor);
            $(".uploadBtn").val("生成二维码失败")
        }

        oReq.send("fileurl=" + param.fileurl + "&device=" + param.comment + "&desc=" + param.desc);

    }


    function transformArrayBufferToBase64(buffer) {
        var binary = '';
        var bytes = new Uint8Array(buffer);
        for (var len = bytes.byteLength, i = 0; i < len; i++) {
            binary += String.fromCharCode(bytes[i]);
        }

        return "data:image/png;base64," + window.btoa(binary);
    }


    //字节大小转换，参数为b
    function bytesToSize(bytes) {
        var sizes = ['Bytes', 'KB', 'MB'];
        if (bytes == 0) return 'n/a';
        var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
        return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
    };

    //通过文件名，返回文件的后缀名
    function fileType(name) {
        var nameArr = name.split(".");
        return nameArr[nameArr.length - 1].toLowerCase();
    }




</script>




</html>