#自己加入或创建的组
SELECT group_id FROM group_user WHERE user_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' UNION #查询加入的组
SELECT id FROM group_ WHERE admin_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' #查询自己为管理员的组

#和自己相关的账单
SELECT account_id FROM account_member WHERE member_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' OR 
member_id IN (SELECT group_id FROM group_user WHERE user_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' UNION 
SELECT id FROM group_ WHERE admin_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ')

#和自己相关的分组
CREATE OR REPLACE VIEW `temp_me_account` AS
SELECT DISTINCT account_id FROM account_member WHERE member_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' OR 
member_id IN (SELECT group_id FROM group_user WHERE user_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' UNION 
SELECT id FROM group_ WHERE admin_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ');
#查询自己创建的组和账单中与自己相关的组的简要信息
SELECT id,NAME,icon,TRUE is_group FROM group_ WHERE admin_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' OR id IN (SELECT member_id FROM account_member WHERE is_group=TRUE AND account_id IN (SELECT account_id FROM temp_me_account))

#---------------------------------------------------------------------------------
#查询自己的帐友id
SELECT accept_id AS id FROM friend WHERE invite_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ'
UNION
SELECT invite_id AS id FROM friend WHERE accept_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ'

#查询自己的帐友简要信息
SELECT id,nickname AS NAME,icon,FALSE is_group FROM USER WHERE id IN(
SELECT accept_id AS id FROM friend WHERE invite_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ'
UNION
SELECT invite_id AS id FROM friend WHERE accept_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ')
#---------------------------------------------------------------------------------



#查询所有和我有关系的组和用户,记账时可选的成员
CREATE OR REPLACE VIEW temp_me_account AS
SELECT DISTINCT account_id FROM account_member WHERE member_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' OR 
member_id IN (SELECT group_id FROM group_user WHERE user_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' UNION 
SELECT id FROM group_ WHERE admin_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ');
#查询自己创建的组和账单中与自己相关的组
SELECT id,NAME,icon,TRUE is_group FROM group_ WHERE admin_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' OR id IN (SELECT member_id FROM account_member WHERE is_group=TRUE AND account_id IN (SELECT account_id FROM temp_me_account))
UNION
SELECT id,nickname AS NAME,icon,FALSE is_group FROM USER WHERE id IN(
SELECT accept_id AS id FROM friend WHERE invite_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ'
UNION
SELECT invite_id AS id FROM friend WHERE accept_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ')

#不使用视图
#查询自己创建的组和账单中与自己相关的组
SELECT id,NAME,icon,TRUE is_group FROM group_ WHERE admin_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' OR 
id IN (
SELECT member_id FROM account_member WHERE is_group=TRUE AND account_id IN (
SELECT account_id FROM account_member WHERE member_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' OR 
member_id IN (SELECT group_id FROM group_user WHERE user_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' UNION 
SELECT id FROM group_ WHERE admin_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ')))
UNION
#查询所有帐友
SELECT id,nickname AS NAME,icon,FALSE is_group FROM USER WHERE id IN(
SELECT accept_id AS id FROM friend WHERE invite_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ'
UNION
SELECT invite_id AS id FROM friend WHERE accept_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ')





















#-------------------------------------------------------------------------------------------------------------

#查询当月总支出
SELECT 'month_paidin' NAME,SUM(money) AS money FROM (
SELECT SUM(paid_in) AS money FROM account WHERE is_private=1 AND user_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' AND DATE_FORMAT(NOW(),'%Y-%m')=DATE_FORMAT(date_timestamp,'%Y-%m')
UNION
SELECT SUM(a.should_pay) AS money FROM account_member AS a LEFT JOIN account AS b ON  a.account_id=b.id WHERE member_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ' AND DATE_FORMAT(NOW(),'%Y-%m')=DATE_FORMAT(b.date_timestamp,'%Y-%m'))AS total

UNION

#查询全部待付款
SELECT 'wait_paid' NAME,SUM(money) FROM account_pay AS a LEFT JOIN account AS b ON a.account_id=b.id WHERE a.paid_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ'

UNION

#查询全部待收款
SELECT 'wait_receipt' NAME,SUM(money) FROM account_pay AS a LEFT JOIN account AS b ON a.account_id=b.id WHERE a.receipt_id='oCBrx0FreB-L8pIQM5_RYDGoWOKQ'
#-------------------------------------------------------------------------------------------------------------